---
import StarlightSidebar from '@astrojs/starlight/components/Sidebar.astro'

import { getRecentBlogEntries } from '../libs/content'
import { isAnyBlogPage, isBlogPostPage, isBlogRoot } from '../libs/route'

const isBlog = isAnyBlogPage(Astro)
const recentEntries = isBlog ? await getRecentBlogEntries() : []
---

<div class="mobile-blog md:hidden">
  <a href="/blog">Blog</a>
</div>
{
  isBlog ? (
    <StarlightSidebar
      sidebar={[
        {
          href: '/blog',
          isCurrent: isBlogRoot(Astro),
          label: 'All posts',
          type: 'link',
        },
        {
          entries: recentEntries.map((blogEntry) => ({
            href: `/${blogEntry.slug}`,
            isCurrent: isBlogPostPage(Astro, blogEntry.slug),
            label: blogEntry.data.title,
            type: 'link',
          })),
          label: 'Recent posts',
          type: 'group',
        },
      ]}
    />
  ) : (
    <StarlightSidebar {...Astro.props} />
  )
}

<style>
  .mobile-blog {
    border-bottom: 1px solid var(--sl-color-gray-6);
    margin-inline: var(--sl-sidebar-pad-x);
    padding-block: 1rem;
  }

  .mobile-blog a {
    color: var(--sl-color-white);
    font-size: var(--sl-text-lg);
    font-weight: 600;
    text-decoration: none;
  }
</style>
